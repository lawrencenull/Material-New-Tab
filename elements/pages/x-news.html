<dom-module id="x-news">

    <!-- ----------------------------------------------------------------------------------------------------------- -->
    <!-- CSS -->
    <style include="shared-styles"></style>
    <style include="news-colors"></style>
    <style>

        h1 {}
        h1 iron-icon { cursor: pointer; padding: 0 0 4px 0; }

        x-news-feed { margin: 0 10px; }

        paper-dialog { min-width: 968px; }
        paper-dialog div.feed {}
        paper-dialog div.feed paper-input { margin: 0 10px 0 0; }
        paper-dialog div.feed paper-input.name { width: 20%; }
        paper-dialog div.feed paper-input.url { width: 30%; }
        paper-dialog div.feed paper-input.icon { width: 20%; }
        paper-dialog div.feed paper-input.count { width: 20%; }
        paper-dialog div.feed paper-button { width: 5%; }

    </style>

    <!-- ----------------------------------------------------------------------------------------------------------- -->
    <!-- HTML -->
    <template>

        <!-- ------------------------------------------- -->
        <!-- Title -->
        <h1>RSS Feeds <iron-icon icon="settings" title="Customize" on-click="openCustomizeDialog"></iron-icon></h1>

        <!-- ------------------------------------------- -->
        <!-- News container -->
        <div class="news horizontal center-justified layout">
            <template is="dom-repeat" items="{{feeds}}" as="feed">
                <x-news-feed feed="[[feed]]"></x-news-feed>
            </template>
        </div>

        <!-- ------------------------------------------- -->
        <!-- RSS feed dialog -->
        <paper-dialog id="customizeDialog" entry-animation="scale-up-animation" exit-animation="scale-down-animation" modal>
            <h2>Your RSS feeds:</h2>
            <div>
                <template is="dom-repeat" items="{{feeds}}" as="feed">
                    <div class="feed horizontal end layout">
                        <paper-input class="name" label="Feed name" value="{{feed.name}}"></paper-input>
                        <paper-input class="url" label="URL" value="{{feed.url}}"></paper-input>
                        <paper-input class="icon" label="Icon" value="{{feed.icon}}"></paper-input>
                        <paper-input class="count" label="Number of articles" value="{{feed.count}}"></paper-input>git
                        <paper-button on-click="deleteFeed" class="delete">Delete</paper-button>
                    </div>
                </template>
                <paper-button on-click="addNewFeed">+ Add new feed</paper-button>
            </div>
            <div class="buttons">
                <paper-button dialog-dismiss>Close</paper-button>
            </div>
        </paper-dialog>

        <!-- ------------------------------------------- -->
        <!-- Localstorage for secret -->
        <iron-localstorage name="material-new-tab-news-feeds"
            id="feedsLocalstorage"
            value="{{feeds}}"
        ></iron-localstorage>

    </template>

    <!-- ----------------------------------------------------------------------------------------------------------- -->
    <!-- Javascript -->
    <script>

        /**
         * Google news feed.
         *
         * @param name
         * @param url
         * @param icon
         * @param count
         */
        function Feed(name, url, icon, count) {
            this.name = name;
            this.url = url;
            this.icon = icon;
            this.count = count;
        }

        Polymer({

            /* ------------------------------------------------------------------------------------------------------ */
            /* Init */

            /**
             * Element initialization and properties definition.
             */
            is: 'x-news',
            properties: {
                feeds: {
                    type: Array,
                    value: []
                }
            },

            /* ------------------------------------------------------------------------------------------------------ */
            /* Lifecycle callbacks */

            /**
             * Called when element is created.
             */
            created: function () {},

            /**
             * Called when element is attached to DOM.
             */
            attached: function () {},

            /**
             * Called when element is detached from DOM.
             */
            detached: function () {},

            /* ------------------------------------------------------------------------------------------------------ */
            /* Observers */

            // ...

            /* ------------------------------------------------------------------------------------------------------ */
            /* Event handlers */

            /**
             * Opens customize dialog.
             */
            openCustomizeDialog: function () {
                this.$.customizeDialog.open();
            },

            /**
             * Adds new feed to feed list.
             */
            addNewFeed: function () {
                if (!this.feeds) {
                    this.feeds = []
                };
                this.push('feeds', new Feed('', '', 'social:public', '5'));
                this.setCardsHeight();
            },

            /**
             * Deletes feed.
             */
            deleteFeed: function (event) {
                var feed = event.model.feed;
                for (var i = 0; i < this.feeds.length; i++) {
                    if (feed.name == this.feeds[i].name) {
                        this.splice('feeds', i, 1);
                    }
                }
            },

            /* ------------------------------------------------------------------------------------------------------ */
            /* Helper functions */

            // ...

        });
    </script>

</dom-module>